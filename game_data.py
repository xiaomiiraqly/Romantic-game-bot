#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
–ú–æ–¥—É–ª—å —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–≥—Ä—ã - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —ç–º–æ–¥–∑–∏ –∏ –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
"""

# –ú—É–∂—Å–∫–∏–µ —ç–º–æ–¥–∑–∏
MALE_EMOJIS = [
    'üë®üèª‚Äçü¶±', 'üë®üèª‚Äçü¶∞', 'üë®üèª‚Äçü¶≥', 'üë®üèª‚Äçü¶≤', 'üßîüèª‚Äç‚ôÇÔ∏è', 
    'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ',
    'ü§£', 'üòÇ', 'üôÇ', 'üôÉ', 'ü•∞',
    'üòç', 'ü§©', 'ü•≥', 'ü§™', 'ü§≠'
]

# –ñ–µ–Ω—Å–∫–∏–µ —ç–º–æ–¥–∑–∏
FEMALE_EMOJIS = [
    'üë©üèª‚Äçü¶±', 'üë©üèª‚Äçü¶∞', 'üë©üèª‚Äçü¶≥', 'üë©üèª‚Äçü¶≤', 'üßïüèª',
    'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ',
    'ü§£', 'üòÇ', 'üôÇ', 'üôÉ', 'ü•∞',
    'üòç', 'ü§©', 'ü•≥', 'üíÅüèª‚Äç‚ôÄÔ∏è', 'üôãüèª‚Äç‚ôÄÔ∏è'
]

# –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–≥—Ä—ã
CATEGORIES = [
    {'key': 'acquaintance', 'name': '–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ', 'color': '#FFFFFF', 'emoji': 'üí´', 'description': '—Ç–µ–º—ã –¥–ª—è —Ä–∞—Å–∫—Ä–µ–ø–æ—â–µ–Ω–∏—è, –æ–±—â–µ–Ω–∏—è, –ø–æ–Ω–∏–º–∞–Ω–∏—è "—Ç–µ–º—ã".'},
    {'key': 'flirt', 'name': '–§–ª–∏—Ä—Ç', 'color': '#FFD700', 'emoji': 'üòâ', 'description': '–∑–∞–¥–∞–Ω–∏—è —Å –ø–æ—Ü–µ–ª—É—è–º–∏, –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏—è–º–∏, —Ñ–ª–∏—Ä—Ç–æ–º. –ü–æ–¥–Ω—è—Ç–∏–µ "–≥—Ä–∞–¥—É—Å–∞" –≤–µ—á–µ—Ä–∞'},
    {'key': 'prelude', 'name': '–ü—Ä–µ–ª—é–¥–∏—è', 'color': '#9370DB', 'emoji': 'üíú', 'description': '–ï—â—ë –±–æ–ª–µ–µ –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è, –≤ –æ—Å–Ω–æ–≤–Ω–æ–º, –¥–ª—è –¥–µ–≤—É—à–µ–∫. –ü—Ä–µ–ª—é–¥–∏—è –∫ —Å–µ–∫—Å—É. –í—ã –≤—Å–µ —É–∂–µ –ø–æ—á—Ç–∏ –≥–æ–ª—ã–µ –∏ —ç—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å –∑–∞–¥–∞–Ω–∏–π –ø–æ–º–æ–∂–µ—Ç –¥–æ–≤–µ—Å—Ç–∏ –¥–µ–ª–æ –¥–æ —Ç–µ–ª–∞, –±–ª–∞–≥–æ–¥–∞—Ä—è –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã–º –ª–∞—Å–∫–∞–º.'},
    {'key': 'fire', 'name': 'üî•', 'color': '#FF4500', 'emoji': 'üî•', 'description': '–£–∂–µ —Ç–æ—á–Ω—ã–µ –ø–æ–∑—ã –∏ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è —Å–µ–∫—Å–∞. –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ: –ø–æ—Å–ª–µ 2-3 –∑–∞–¥–∞–Ω–∏–π –∏–≥—Ä–æ–∫–∏ –∑–∞–±—ã–≤–∞—é—Ç –æ–± –∏–≥—Ä–µ. –û—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ–∑–≤–æ–ª—è—Ç –Ω–∞—Å–ª–∞–¥–∏—Ç—å—Å—è –≤ –ø–æ–ª–Ω–æ–π –º–µ—Ä–µ —Ñ–æ—Ä–º–∞—Ç–æ–º –ú–ñ–ú–ñ'},
]

# –†–µ–∂–∏–º—ã –∏–≥—Ä—ã
GAME_MODES = [
    {
        'key': '2couples',
        'name': '2 –ø–∞—Ä—ã',
        'description': '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º –¥–ª—è –¥–≤—É—Ö –ø–∞—Ä (4 –∏–≥—Ä–æ–∫–∞)',
        'players_count': 4,
        'gender_distribution': {'male': 2, 'female': 2},
        'emoji': 'üë´üë´'
    },
    {
        'key': 'fmf',
        'name': '2 –¥–µ–≤—É—à–∫–∏ + 1 –ø–∞—Ä–µ–Ω—å',
        'description': '–†–µ–∂–∏–º –ñ–ú–ñ - –¥–≤–µ –¥–µ–≤—É—à–∫–∏ –∏ –æ–¥–∏–Ω –º—É–∂—á–∏–Ω–∞',
        'players_count': 3,
        'gender_distribution': {'male': 1, 'female': 2},
        'emoji': 'üë©‚Äç‚ù§Ô∏è‚Äçüë®üë©'
    },
    {
        'key': 'mfm',
        'name': '2 –ø–∞—Ä–Ω—è + 1 –¥–µ–≤—É—à–∫–∞',
        'description': '–†–µ–∂–∏–º –ú–ñ–ú - –¥–≤–∞ –º—É–∂—á–∏–Ω—ã –∏ –æ–¥–Ω–∞ –¥–µ–≤—É—à–∫–∞',
        'players_count': 3,
        'gender_distribution': {'male': 2, 'female': 1},
        'emoji': 'üë®‚Äç‚ù§Ô∏è‚Äçüë®üë©'
    }
]

def get_game_mode_info(mode_key: str) -> dict:
    """–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∂–∏–º–µ –∏–≥—Ä—ã –ø–æ –∫–ª—é—á—É"""
    for mode in GAME_MODES:
        if mode['key'] == mode_key:
            return mode
    return GAME_MODES[0]  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

def validate_players_for_mode(players: list, mode_key: str) -> tuple:
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞"""
    mode_info = get_game_mode_info(mode_key)
    required_distribution = mode_info['gender_distribution']
    
    # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –ø–æ–ª—É
    male_count = sum(1 for player in players if player.get('gender') == 'male')
    female_count = sum(1 for player in players if player.get('gender') == 'female')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
    if male_count != required_distribution['male']:
        return False, f"–û–∂–∏–¥–∞–µ—Ç—Å—è {required_distribution['male']} –º—É–∂—á–∏–Ω(–∞), –ø–æ–ª—É—á–µ–Ω–æ {male_count}"
    
    if female_count != required_distribution['female']:
        return False, f"–û–∂–∏–¥–∞–µ—Ç—Å—è {required_distribution['female']} –∂–µ–Ω—â–∏–Ω(—ã), –ø–æ–ª—É—á–µ–Ω–æ {female_count}"
    
    return True, "OK"

def get_initial_task_bank():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –Ω–∞–±–æ—Ä –∑–∞–¥–∞–Ω–∏–π (–∑–∞–¥–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã)"""
    return {}

