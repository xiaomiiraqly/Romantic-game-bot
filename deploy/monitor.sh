#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞
# –ê–≤—Ç–æ—Ä: MPR_XO
# –í–µ—Ä—Å–∏—è: 1.0

echo "üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì TELEGRAM –ë–û–¢–ê"
echo "================================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
echo "üîç –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞:"
systemctl is-active telegram-bot
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
echo "üíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:"
ps aux | grep "python main.py" | grep -v grep | awk '{print "PID:", $2, "CPU:", $3"%", "RAM:", $4"%", "–í—Ä–µ–º—è:", $10}'
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
echo "üìÅ –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:"
if [ -f "/opt/telegram-bot/bot.db" ]; then
    ls -lh /opt/telegram-bot/bot.db | awk '{print "–†–∞–∑–º–µ—Ä:", $5, "–î–∞—Ç–∞:", $6, $7, $8}'
else
    echo "‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
fi
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
echo "üö® –û—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å:"
if [ -f "/opt/telegram-bot/logs/errors.log" ]; then
    ERROR_COUNT=$(grep "$(date '+%Y-%m-%d %H')" /opt/telegram-bot/logs/errors.log | wc -l)
    echo "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫: $ERROR_COUNT"
    if [ $ERROR_COUNT -gt 0 ]; then
        echo "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏:"
        tail -5 /opt/telegram-bot/logs/errors.log
    fi
else
    echo "–§–∞–π–ª –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
echo "üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:"
if ping -c 1 api.telegram.org > /dev/null 2>&1; then
    echo "‚úÖ Telegram API –¥–æ—Å—Ç—É–ø–µ–Ω"
else
    echo "‚ùå Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
fi
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
echo "üíø –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞:"
df -h /opt/telegram-bot | tail -1 | awk '{print "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:", $3, "–∏–∑", $2, "(" $5 ")"}'
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –ª–æ–≥–∞—Ö
echo "üìã –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:"
if [ -f "/opt/telegram-bot/logs/bot.log" ]; then
    LAST_ACTIVITY=$(tail -1 /opt/telegram-bot/logs/bot.log | cut -d' ' -f1-2)
    echo "–ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥–µ: $LAST_ACTIVITY"
else
    echo "–§–∞–π–ª –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ª–æ–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi
echo ""

echo "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω"
